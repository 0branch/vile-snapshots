Changes for vile 9.1 (released ??? ??? ??, 1999)

 (kev) 991220 (h)
	+ perl/capture.pl: New perl script which implements a perl version
	  of capture-command.  This version incrementally updates the
	  window however.
	+ perl/winops.pl: New perl script which implements various window
	  related operations.  Good for testing implementation of the
	  Vile::Window API.
 	+ perl.xs: Documentation fixes.
	  (package Vile::Window):  Documentation and implementation of
	  Vile::Window API.
	  (perl_free_callback): Disable deallocation of the coderef since
	  this causes problems when called from within the subroutine
	  being deallocated.  Added a FIXME comment noting the problem.
	  (set_selection, selection_buffer): Fixed croak messages.
	  (dotq): New Vile::Buffer method.
	+ api.c (api_dotinsert): Set changed flag.  This fixes a bug
	  where perl would add characters to the buffer, but they
	  wouldn't appear until the user did something else to force
	  a hard update.
	  (api_command_cleanup): Make sure results of unmark operation
	  get propagated back to the editor.
	+ api.h (VileWin): Declare.
	+ buffer.c (swbuffer_lfl): Don't call undispbuff() unless all
	  windows associated with the buffer are gone.
	+ estruct.h (WINDOW): Added w_id as a new field to this structure.
	+ window.c, proto.h (id2win, win2id, index2win, win2index):
	  New functions.
	+ window.c (w_id_next): New static global.
	  (FAKE_WINDOW_ID): New define.
	  (splitw, winit, push_fake_win): Set/initialize w_id field in
	  WINDOW structure.
	+ ptypemap (T_VileWin): New type in typemap.
	+ x11.c (x_autocolor_timeout): Send a null message to ourselves
	  to prevent stalling in the event loop.  This fixes the bug
	  in which a keypress while the filter was running would
	  cause the keypress to be noticed at the next X event.
	  (paste_from_primary): New function.
	+ cmdtbl (paste-from-primary): New command.  (Requested by Sean
	  Ahern.)

 (kev) 991219 (g)
	+ cmdtbl, buffer.c:  Added binding / support for ^X-_ aka
	  "historical-buffer-to-current-window".  [Requested by Mike J.  Bell.]
	+ random.c (autocolor):  Save/restore pre_op_dot.  Fixes bug reported
	  by Paul Fox:  "if autocoloring kicks in between an operation and the
	  motion that completes it (e.g.  'd' and 'w'), the operation acts on
	  the wrong selected region -- i think it acts on 'dot to top of
	  buffer'."
	+ improve set-window (actually swbuffer()) by initializing a window's
	  traits, e.g., position, from the buffer's traits.
	+ buffer.c (swbuffer_lfl):  Make sure window count gets decremented for
	  the window being replaced even if buffer we're replacing it with is
	  already on-screen (fixes a core dump in set-window, reported by Clark
	  Morgan).
	+ fileio.c (ffclose): Use mlwrite() instead of mlforce().
	+ edef.h (in_autocolor): New variable.
	+ display.c (mlerase, mlwrite):  Use in_autocolor to determine whether
	  or not to position the cursor on the message line.
	+ random.c (autocolor): Set autocolor as appropriate.
	+ macros/vileinit.rc, vile.hlp:  Revise so that autocolor timeouts are
	  in milliseconds.
	+ termio.c (ttgetc): Likewise.
	+ x11.c (x_start_autocolor_timer): Ditto.
	> Clark Morgan:
	+ ifdef'd autocolor mode and logic with OPT_COLOR to accommodate VMS,
	  which does not support syntax highlighting anyway.
	+ fix vmsbuild.com for the case of building xvile.exe with VAXC, adding
	  menu.obj to vms_link.opt _before_ the CRT.  That ensures that the
	  linker looks for menu.obj in the cwd, not in sys$library.
	> Tom Dickey:
	+ improve logic of repaint_window(), so it paints long chunks rather
	  than single characters.  This makes the screen paint properly when
	  switching to an Italic font.
	+ refine logic for gui_resize_in_progress in ntwinio.c so that it
	  only affects the case where a font-sizechange is in progress.
	  This restores the behavior of 8.3d, which allows a user to specify
	  $pagewid and $pagelen in vile.rc to control the initial screensize
	  (reported by George Young <gryoung@nortelnetworks.com>).
	+ add $brightness variable to winvile, allowing users to customize the
	  overall intensity of colors, to accommodate different monitors
	  (prompted by Chris Green <cgreen@x-1.net>).
	+ modify backspacelimit mode to allow backspacing through a newline
	  when nobackspacelimit is specified (request by Todd Moody
	  <tmoody@mailhost.sju.edu>).
	+ change Kevin's use of in_autocolor which suppresses message-output to
	  make that part of ~hidden behavior.
	+ remove elif/else clauses from m4mode "do" group, since they interfere
	  too much with balancing square brackets intermixed with parentheses.
	+ implement poll()-based watchfd/autocolor support.
	+ implement BeOS-specific watchfd/autocolor support, by rearranging
	  logic used for catnap(): beos_has_input(), beos_can_output() and
	  beos_napms().
	+ make repeat-count apply to @register commands.  This repeats the
	  entire command, and is not necessarily compatible with vi: some
	  implementations do not recognize a repeat count, and other, e.g.,
	  SVr3 repeat the last command in the register contents.  elvis does
	  the former, nvi does the latter, and vim repeats the entire string.
	  It's fortunate that the simpler implementation is more useful
	  (requested by Ed Henderson).
	+ modify vilefilt.l to recognize .vilemenu syntax.
	+ modify menu.c to allow double-quote as comment-marker.
	+ remove full-line behavior from goto-char command.
	+ correct behavior of "Clear Highlighting (below)" menu entry in sample
	  vilemenu.rc which did not clear the final line of a buffer (sorry - I
	  misplaced the original report).
	+ add some pointer checks to swbuffer(), getcol() and gocol(), so
	  piping to vile works properly when trying to initialize window's
	  traits.
	+ add a note about set-window to vile.hlp
	+ improve coloring of literals in vilefilt.l by interpreting strings
	  beginning with ^A, ^X or escape.
	+ modify c-filt.c show nested-comment as error.
	+ fix c-filt.c to highlight properly a number immediately after a
	  leading "#", to accommodate non-standard usage by GCC's preprocessor.

 (kev) 991214 (f)
 	+ buffer.c (chg_buff, unchg_buff): Set the "recently changed"
	  flag for syntax coloring purposes.
	+ edef.h (autocolorhook): Declare.
	+ macros/vileinit.rc: Added example code for automatic syntax
	  coloring.
	+ main.c (global_val_init): Initialize VAL_AUTOCOLOR.
	+ modetbl (AUTOCOLOR): New mode.
	  (autocolor-hook): New hook.
	+ perl/shell.pl: Revised to use IO:Pty instead of Comm.pl (which
	  seems to be no longer maintained).
	+ proto.h (autocolor, ttwatchfd, ttunwatchfd): New declarations.
	+ random.c (run_a_hook): Return status from running the command
	  instead of unconditionally returning TRUE.
	  (autocolor): New function.
	+ statevar.c (var_AUTOCOLORHOOK): New function.
	+ tcap.c (term): Use ttwatchfd and ttunwatchfd instead of the
	  nullterm versions.
	+ termio.c (USE_SELECT): New alternative to USE_FCNTL and
	  USE_FIONREAD.  Preferred over both of these methods for
	  determining if there are new characters to be read from
	  the keyboard.
	  (watchfd_read_fds, watchfd_write_fds, watchfd_maxfd): New
	  static variables.
	  (ttwatchfd, ttunwatchfd): New functions.
	  (ttgetc): Added new USE_SELECT code for reading a character.
	  This new code also watches for activity on file descriptors
	  registered with watchfd() and will invoke the automatic
	  syntax coloring function, autocolor, as appropriate.
	+ vile.hlp: Documented new autocolor mechanism.
	+ x11.c (x_start_autocolor_timer, x_autocolor_timeout,
	  x_stop_autocolor_timer): New functions.
	  (x_getc): Call x_start_autocolor_timer and x_stop_autocolor_timer
	  as appropriate.
	  (x_key_press): Call x_start_autocolor_timer to reset the timer
	  on each keystroke.
 	> patches by Tom Dickey:
	+ color continued comment-lines in makemode.
	+ correct c-filt.c parsing of numbers such as 0.0, from 9.0e rewrite.
	+ correct display of termcap numbers, which were highlighted as errors
	  after allowing '#' in capability-names.

 (tom) 991212 (e)
 	+ improve c-filt.c's parsing of numbers to flag spuriously-repeated
	  suffixes as errors (request by Kevin Buettner).
	+ indent'd word.c, add a special case to avoid putting two spaces after
	  "i.e." or "e.g." to accommodate some European usage.
	+ add several perl5 keywords to perl.key (listed by <abigail@delanet.com>)
	+ remove "unsetl view" logic from :f command, since it is an obscure
	  and not desirable side-effect.  Appeared in filename() and
	  commdlg_save_file() (reported by Clark Morgan).
 	+ modify HighlightFilter to check if user is trying to run this with
	  winvile w/o w32pipes set.  That combination does not work, so don't
	  try it.
	+ update CF_ANSI_CC_CHECK to match that in tin, which now uses -Ae
	  option for HPUX (patch by Urs Jansen).
	+ modify config.sub to recognize ia64 machine (patch by Kevin Buettner).
 	+ allow '_' and '.' in terminfo aliases.
 	+ correct a file-descriptor leak in npflush for win32, which showed up
	  as undeleted temp-files.  This would happen when opening read/write
	  pipes, e.g., for syntax filtering, when now32pipe was specified.
	+ remove obsolete/unused Win31 ifdef's (reported by Clark Morgan).
	> patch by Clark Morgan:
	+ changed the VMS build document (README.VMS) to specify exclusive use
	  of vmsbuild.com rather than MMS directly.
	+ changed vmsbuild.com to accept a compiler specification on the
	  command line, which is much more convenient than editing the build
	  script by hand.  compiler defaults to VAXC on Vax hosts and DECC on
	  Alpha hosts.

 (tom) 991209 (d)
	+ implement "before" and "after" qualifiers for majormodes.
 	+ add C++ majormode cppmode,
 	+ change prompt for majormode in procedure parameter lists to allow
	  mixed case.
 	+ add ".table" and ".default" to filter interpreter.
	+ add a syntax filter for vile's .key files, use that to fix some
	  errors in make.key, tcl.key .
 	+ add a syntax filter for Lynx config file.
	+ add '_' to URL patterns, used in txt and mail filters.
 	+ corrected DSTRINGS definition in awk syntax filter, which did not
	  handle quoted backslash.
	+ allow '+' in alias in termcap syntax filter.
	+ add variable $error-buffer, use this in manpage.rc to avoid losing
	  the setting when creating a manpage buffer.
	+ add error-patterns for ncurses tic and atac.
 	+ implement ".merge" in filter keyword files, needed for C and HTML
	  filters.
	+ improve C syntax filter:
	  + marking misspelled preprocessor keywords as an error.
	  + marking numbers run-on to names as an error,
	  + marking unexpected escapes as an error,
 	+ minor fixes of ifdef's for glob_match_leaf(), for building with
	  configure --disable-extensions.
	> patches by Clark Morgan:
	+ add the Win32 common dialog "save as" feature to both console
	  vile and winvile.
	+ update vile.hlp was updated to reflect recent
	  questions about macros.doc
	+ split-out the win32 command-specific code (e.g., winopen, winsave,
	  etc) from w32misc.c to a new file called w32cmd.c
	+ add a note about obscure "unsetl view" side-effect of the :f command
	+ add special case to expand_wild_args() for VMS to handle +/string
	  syntax.
	+ update README.VMS for building xvile
	+ fix for VAXC to include icons/vile.xbm

 (tom) 991202 (c)
	+ modified vmsbuild.com and descrip.mms (untested) to build the Motif
	  version with menus, the X toolkit version without (based on discussion
	  with Clark Morgan and Jonathan Ridler).
 	+ fix ttclean() function for xvile on VMS (Clark Morgan, from problem
	  report by Jonathan Ridler <JONATHAN@rubens.its.unimelb.edu.au>).
	+ add .Xdefaults to xresmode.
 	+ add backslashes as needed to digraph.rc, to work with the new single
	  quote interpretation (reported by Paul Fox).
 	+ correct a place where expression evaluation result was overwritten
	  with the nested result in a complex expression from 8.3d (reported
	  by George Eccles).
 	+ highlight whitespace in makefiles between backspace and newline as
	  an error.
	+ define "Error" class for syntax filters.
	+ correct make filter's handling of escaped newline: '.' does not match
	  newline.

 (tom) 991127 (b)
 	+ add "case" and "do" groups to m4mode.
 	+ add ".ms" and ".me" suffixes for nrmode.
	+ add ``quote'' quoting to txt filter.
	+ refine treatment of double-quote in txt filter so it can be quoted
	  by single-quote or parenthesis.
	+ allow "~" in URL patterns for txt and mail filters, omitted in 9.0a.
 	+ correct some missing backslashes before vertical bar and parentheses
	  in filters.rc, made apparent by the change to use single-quoted
	  strings.
	+ restore handling of special control characters such as ^D, ^T in
	  insert mode which happened to be GOAL or MOTION commands (reported by
	  Clark Morgan).

 (tom) 991124 (a)
	+ add single-quoted strings, which eliminate the need for escaping
	  backslash (suggested by Paul Fox).
	+ modify logic in ins_any_time() to interpret control characters which
	  are bound to GOAL or MOTION commands rather than inserting them
	  without quoting.  This allows ^E and ^Y as commands within an insert
	  (request by Quang Ngo <quang@usa.net>).
	+ change several commands to use GOAL flag, which tells vile that they
	  may move to a new line, but try to keep the column constant.  Doing
	  this has the side-effect that they are usable in quoted-motion:
	  grow-window, move-next-window-down, move-next-window-up,
	  position-window (z), redraw-display, scroll-next-window-down,
	  scroll-next-window-up and shrink-window, as well as api_motion().
 	+ modify quoted-motion so that commands with the GOAL flag are allowed,
	  since those do not change the buffer contents.
	+ change handling of status return from readpattern() so that an abort
	  is passed up to the caller.  In execute-named-procedure, check for
	  abort, and restore DOT to the value before evaluating addresses
	  (reported by Clark Morgan).
 	+ correct bug in wrapmargin/fillcol logic which did not split a line
	  when a newline was inserted into a string containing no blanks
	  after the fillcol position.  Instead, an empty line was inserted
	  (reported by Clark Morgan).
 	+ correct missing allocation of default help-string for user-defined
	  procedures, which could cause core dump if a procedure were redefined,
	  e.g., by source'ing .vilerc (reported by Paul Fox).
 	+ add tags syntax filter and majormode tagsmode.
	+ add X resource syntax filter and majormode xresmode.
	+ improve URL pattern in mail and txt filters, to allow it to match
	  ftp and other URL types, as well as limited the pattern to avoid
	  picking up things like trailing '>' characters.
	+ correct some syntax filters' expressions for REAL, which were
	  expecting two digits after the decimal point, rather one.
	> patches by Clark Morgan:
	+ enable "kill-buffer <wildcard-expr>" on VMS.
	+ fix to allow accessing multiple versions of DECNET-based files.
	  That is, this now works:
		$ vile node::dir:log.txt;*       <- open all copies of log.txt
	+ eliminate stray cursor glyphs in the message buffer (most often
	  happens when a Win32 dialog is dismissed at the "same time" that a
	  winvile command writes status text).

This change log started on Friday Nov 19, 1999.
