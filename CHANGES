Changes for vile 9.1 (released ??? ??? ??, 1999)

 20000114 (s)
 	> Kevin Buettner:
	+ perl.xs (do_perl_cmd):  Partially revert changes from 9.0p regarding
	  the clexec/isnamedcmd/no_msgs flags.  We (once again) set isnamedcmd
	  to TRUE in order to cause mlreply_dir and mlreply_file to prompt the
	  user when a perl command is invoked via a key binding. 
	  (mlreply_no_opts): Remove. 
	  (mlreply): Make mlreply_no_opts and mlreply_shell aliases with 
	  slightly different functionality. 
	+ perl/capture.pm: 
	  + New documentation. 
	  + New command, async-capture-command, for displaying 
	    the documentation. 
	  + Use mlreply_shell in order to provide the appropriate shell
	    completions.  [Requested by Paul Fox.]
	  + Remember last command run.  [Also requested by Paul Fox.] 
	  + Added work-around to prevent [Buffer not found] message from
	    displaying when Vile::Buffer::edit is asked to find an internal
	    buffer.  (Does getfile2bp really need to call mlforce() to print
	    this message out?)
	+ perl/shell.pm: 
	  + New documentation. 
	  + New command, shell-help, for displaying the documentation. 
	  + Handle partial (incomplete) terminal control sequences. 
	    [Fixes bugs reported by Paul Fox.] 
	  + gdb annotation support.  (Use --fullname with gdb to make 
	    use of this.) 
	  + Facilities for supporting upcoming gdb.pm. 
	  + Revise mechanism for escaping from shell.  (Expect it to 
	    be revised even more though.) 
	> Clark Morgan:
	+ modify mailmode to support mutt's temporary file names 
	+ modify nttypahead() to exit immediately during an autocolor operation.
	+ add section on 'Color Basics' to vile.hlp, integrated/revised with
	  description of color syntax highlighting (with feedback from Brendan
	  O'Dea and Paul Fox).
	> Tom Dickey:
	+ modify suffix qualifiers of cshmode and mailmode to avoid matching
	  directory names.
	+ corrected status checks on return from prompt_scheme_name(), which
	  may be ABORT (reported by Paul Fox).

 20000112 (r)
 	> Kevin Buettner:
	+ correct two variables in perl.xs which were incorrectly typed as
	  'int', and passed by reference which is a problem on Tru64 Unix 5.0
	  (Alpha) where the prototype specified 'unsigned long' (reported by
	  Larry Gensch <larry.gensch@compaq.com>)
	> Clark Morgan:
	+ update credits in vile.hlp (with additions from Paul Fox).
	+ updated w32modes.doc
	+ remove very stale documentation/comment from c-filt.c .
	+ add -q switch to filters.c, which forces the filter to exit as soon
	  as it reads its first line of input.  Useful in conjunction with -v
	  and -vv switches.  Necessary for Unix vile (but not win32 vile) if
	  you want to do this:
	      ^X-!~/.vile/vile-c-filt -vvq
	  without hanging the editor's keyboard and forcing the user to type ^C
	  to kill the child process.
	+ fix a 250 millisecond dead spot built into the winvile autoscrolling
	  computations, and also throttle back the initial rate of scrolling so
	  that the user has a chance to read the text as it moves up/down the
	  screen.
	+ reword/correct the description of searching for .keywords files in
	  doc/filters.doc
	> Tom Dickey:
	+ modify ins_anytime(), allowing undoable commands to be executed
	  within an insertion (Clark Morgan stated that the winvile
	  paste-from-clipboard used to work in insertion mode).
	+ correct logic of gotoeosent(), which would skip past the end of the
	  current sentence (which ended at the end of a line), over following
	  blank lines, to the end of the next text line.  Now it skips into the
	  beginning of the first line following the sentence.  A following call
	  will skip the blank lines to the beginning of the next text line
	  (reported by Clark Morgan).
	+ add README*, CHANGES*, ChangeLog* and COPYING to txtmode suffix
	  qualifier.
	+ modify makefilt.l to flag as an error lines that start a quote but
	  do not end it.  Some make programs allow this.
	+ modify suffix qualifiers for imake, mail, make, vile majormodes to ensure
	  they do not match directory names such as /mail/.
	+ modify directive_arg_eval() to expand "~/" expressions for non-UNIX
	  systems, making "so ~/vile.rc" work within a source'd file on WinNT
	  (reported by Clark Morgan).
	+ modify install rule for Vileserv.pm to ensure we update the path
	  of the perl program embedded in that script.
	+ modify vileperl.rc so the terminfo/termcap version does not start
	  the edit-server.
	+ add a null-pointer check for wp in AutoScroll().
	+ modify previndent() to refrain from copying previous indent over a
	  line beginning with '#' if cindent is disabled (reported by Clark
	  Morgan).
	+ change show-colors command to reflect limited number of colors if
	  $ncolors is set to 2, 8 or 16.
	+ modify set_colors() to allow initializing to white/black if termcap
	  or terminfo has no color specified.  This makes the list shown for
	  visual-matches limited to the available colors (reported by Clark
	  Morgan).

 20000109 (q)
	> Ed Henderson <evhendrs@micron.net>:
	+ implement autoscrolling feature for winvile, which makes the buffer
	  scroll in the direction where the mouse leaves the window,
	  automatically extending selection highlighting.
	+ make the scroll speed increase over time, rather than distance
	  above/below the window (suggested by Clark Morgan).
	> Clark Morgan:
	+ fix build with dbg=1 for winvile (reported by Ed Henderson).
	+ update doc/modes.doc, using ~with to simplify perlmode example, and
	  adding cindent to cmode description.
	> Brendan O'Dea:
	+ back out change that attempted to make the .pl files use "#!/bin/echo"
	  to work around a warning from the Debian package checker - but it now
	  adds a different warning.
	> Tom Dickey:
	+ modify configure --with-xpm option to allow builder to specify path
	  of Xpm library in the configure --with-xpm option (adapted from patch
	  by Albert Chin-A-Young <china@thewrittenword.com>).
	+ modify sh-filt.c to mark ':' lines as Action (should be ':'
	  statements, but we do not parse statements yet).
	+ modify key-filt.c to show color codes in Action color rather than
	  Literal, to make it simpler to distinguish special constants such
	  as m4's LeftQuote.
	+ document show-colors and show-color-schemes in vile.hlp
	+ modify the [Color Palette] buffer created by show-colors to make it
	  clearer that the internal codes used in the syntax filters are a
	  single hexadecimal digit (suggested by Clark Morgan).
	+ comment-out the perlmode "while" group, since perl's ambiguities make
	  it not very useful.  Retained the default (if) group, since there are
	  usually more if/elsif/else statements than the others (feedback from
	  Kevin Buettner).
	+ add table entries to tcap.c for terminfo italic mode (sitm/ritm),
	  with terminfo's termcap equivalences (ZH/ZR).  If not found, we
	  continue to fallback to underlining.

 20000104 (p)
	> Kevin Buettner:
	+ window.c (push_fake_win, pop_fake_win): Set curbp.
	+ api.c, select.c:  Change callers of push_fake_win and pop_fake_win to
	  not set curbp.  Actually, it wouldn't hurt, but you'd have to be
	  careful to make sure the setting and restoring is done in the proper
	  order.  [Fixes bug reported by Clark Morgan in which only one dirty
	  window would get colored at a time.]
	+ perl.xs: Minor doc fixes.
	> Clark Morgan:
	+ implement autocolor for win32 console and GUI.
	+ fix some stale doc in doc/macros.doc
	+ fix compiler warnings in ntwinio.c
	> Brendan O'Dea:
	+ remove the clexec/isnamedcmd/no_msgs tweaking in perl.xs for perl
	  commands.  These flags were changed to allow mlreply* to work
	  interactively when perl subs such as hgrep were called from a wrapper
	  macro, although this makes using a registered perl extension
	  non-interactively impossible.
	> Tom Dickey:
	+ minor correction to perl filter, special cases of backslashing to
	  handle perl5's MM_Win32.pm, which incidentally contains a syntax
	  error right after "UNINSTALL =".
	+ modify DrawMenuBar() to use HWND parameter rather than HMENU, as
	  documented (reported by Rick Sladkey).
	+ correct a couple of missing characters after backslashes in perl and
	  sql modes (reported by Kevin Buettner).
	+ add pattern to finderr.c for SGI 7.3 SGI MIPSpro 7.3 compilers (from
	  Anton Koning <anton@sara.nl>).
	+ minor keyword additions for C and Java.

 20000104 (o)
	> Kevin Buettner:
	+ modify updattrs() and offs2col() to fix an extra highlighted
	  character at the end of the line.
	+ add a check to update() to ensure the current window is visible,
	  fixes a case where autocoloring would pick up a buffer with negativa
	  row value (reported by Clark Morgan).
	> Brendan O'Dea:
	+ uncomment line in directory.pm which keeps vile's $cwd variable
	  updated, so hypertext links will work better.
	+ remove doc/hilite.doc, since the corresponding script is gone.
	> Clark Morgan:
	+ miscellaneous updates to vile.hlp
	> Tom Dickey:
	+ fix a null-pointer reference in make_current() (reported by Clark
	  Morgan).
	+ modify autocolor() to refrain from coloring buffers that are not
	  associated with a majormode, e.g., [Buffer List] (reported by
	  Clark Morgan).
	+ minor optimization of offs2col(), moved expressions out of loop.
	+ set/clear 'reading_msg_line' in mlyesno() and mlquickask() to make
	  them behave more like mlreply().  This prevents autocolor from wiping
	  out the highlighting set by substitutions such as
	  	:%s/pat/replacement/gc
	  (reported by Kevin Buettner).

 20000102 (n)
	> Kevin Buettner:
	+ perl/shell.pm:  Better terminal emulation; several bugs fixed.
	+ perl.xs (do_perl_cmd):  Make sure that curwp is visible on the way
	  out.
	> Brendan O'Dea:
	+ improve Manual.pm, getting highlighting as perldoc does, using nroff
	  and vile-manfilt.
	+ corrections to 9.0m changes to make directory.pm and dirlist.pm work
	  on win32 (comparison for $os was not against proper types, besides
	  Perl has $^O to identify the operating system)
	> Tom Dickey:
	+ modify xvile so that if the -title option is given, xvile will not
	  automatically set the window's title.  Setting $title explicitly will
	  still work (reported by Eric Krohn).
	+ correct usage-message for xvile's options, i.e., -title is used
	  rather than -wm and -T option is used to specify a tag.

 (kev) 991231 (m)
	+ doc/macros.doc, macros/vileperl.rc, perl.xs, vile.hlp:  Fix hgrep
	  references; hgrep.pl is now hgrep.pm.  Also, fixed usage examples.
	+ makefile.in:  Added perl modules Glob2re.pm, Vile/Manual.pm,
	  Visit.pm, dirlist.pm.  Removed glob2re.pl and visit.pl.
	+ perl/Glob2re.pm, perl/Visit.pm:  Renamed and revised from the .pl
	  versions.
	+ perl/glob2re.pl, perl/visit.pl: Removed these files.
	+ perl/Vile/Manual.pm: New file for displaying embedded POD
	  documentation.
	+ perl/dirlist.pm:  New file; creates a flat hierarchical directory
	  listing.
	+ perl/hgrep.pm:  Moved introductory comments to end of file and
	  rewrote in POD format.  Added binding hgrep-help which will display
	  the POD documenation.  Fixed problem with backslashes in the buffer
	  name given to the error-buffer command.
	+ perl.xs:
	  + (newVBrv):  Revert change in "l" which was supposed to prevent
	    circular structure from being created.
	  + (perl_free_handle):  Instead, break circular structure here so
	    handle will get freed properly.  [Analysis by Brendan O'Dea.]
	> Brendan O'Dea:
	+ Vileserv now also works for vile.
	+ registration commands are a bit more efficient when the module is
	  already loaded.
	+ hgrep now sets error-buffer internally.
	+ add perl "use capture".
	> Tom Dickey:
	+ modify Vile::get() method to accept functions, used to replace use
	  of `pwd` in perl scripts to make them portable to win32 [Brendan
	  O'Dea points out that there is Cwd.pm for this sort of thing].
	+ modify directory.pm and dirlist.pm to make them work on win32, i.e.,
	  by not executing portions that will not work (such as mime types) and
	  using vile's builtin functions to workaround deficiencies in perl.
	+ add check in vileperl.rc to avoid registering scripts that will not
	  work on win32.

 (tom) 991229 (l)
 	+ save/restore selection highlighting in attribute-from-filter, so that
	  autocolor does not clear the current selection.
	+ add OS/2 EMX to list of platforms that must open text files in binary
	  mode, to see trailing carriage-returns on a line in vileinit.rc
	+ modify makefile.wnt to copy the .rc files to $VILE_STARTUP_PATH
	  during build, as the Perl files already were.
 	+ update makefile.wnt to install renamed/new Perl scripts
 	+ modify tc-filt.l to flag as an error an unescaped newline within
	  a description.
	+ modify c-filt.c to flag as an error a multi-line literal which is
	  missing a backslashed newline.  This is allowed by gcc, but the
	  C standard is explicit.
	+ modify c-filt.c to not treat a line beginning with a '#' if the
	  previous line ended with a backslash.  This is needed to not flag as
	  an error tokens in a macro which are quoted with '#'.
 	+ update vileperl.rc to work with Brendan's renaming/simplification.
 	> Paul Fox:
	+ add cc and reply-to to the list of recognized mail headers, and makes
	  them all caseless.
	+ also added '+' as a valid character in email names, since more and
	  more people are using the user+foo style convention mail sorting.
	> Kevin Buettner:
	+ buffer.c (killbuffer):  When attempting to free more than one buffer
	  by use of a glob expression, don't use recently freed memory after a
	  buffer kill to obtain the next buffer to check.
	+ perl/hgrep.pl:  Change "rgrep" to "hgrep".  Also, don't allow buffer
	  to be autocolor'd.
	+ perl.xs (PDEBUG):  Added/revised code for debugging reference counts.
	  + (newVBrv):  Pass NULL for the obj (second) parameter to sv_magic().
	    This prevents a circular structure from being created which was
	    quite difficult for Perl to free properly.  (newVBrv):  Removed
	    extraneous calls to SvREFCNT_inc().  [Analysis by Brendan O'Dea.]
	  + (do_perl_cmd, svcurbuf_set):  Don't use sv_2mortal() on the new SV
	    passed to newVBrv().  Instead, explicitly call SvREFCNT_dec() on it
	    after svcurbuf assignment.  [Analysis by Brendan O'Dea.]
	  + (do_perl_cmd):  Instead of doing an explicit SvREFCNT_dec() on
	    svcurbuf, assign undef to this variable.  This will still decrement
	    the reference count.  I think this is the reason we needed the
	    extra SvREFCNT_inc() statements.  We would decrement the reference
	    count here without also removing the reference.  As a result, when
	    svcurbuf was assigned to again, the reference count was decremented
	    again on the thing being replaced.
	+ makefile.in: Look for perl .pm files in the perl subdirectory.
	+ hgrep.pl: Set up the error finder.
	> Brendan O'Dea:
	+ Deletes hilight.pl, manfilt.pl, syntax.pl and tailf.pl.
	+ rename most .pl files to .pm (makefile.in).
	+ add an Exporter-like mechanism to Perl5 interface, although instead
	  of exposing a module's functions to the caller, it exposes them to
	  vile as registered commands.  By renaming the extensions as `.pm',
	  and making some minor changes to use Vile::Exporter, an extension
	  becomes visible by simply adding:
		  use extension;
	  to vileinit.pl.  There is also provision for only including some
	  commands provided by the extension, and for overriding the keybinding
	  defined by the developer (documented in the attached module).
	  Of course you can still say:
		   require extension;
	  and do the registering yourself if you so choose.

 (tom) 991226 (k)
	+ disable autocolor in manpage.rc macros, which have txtmode set.
	+ suppress autocolor when 'working...' message is active.
	+ modify filters.c to always initialize predefined classes whenever
	  a symbol table is created.  It was done before only for the first
	  symbol table, which meant that some filters using multiple symbol
	  tables were not able to use class names for keyword attributes.
	+ change cpp.key's inclusion of c.key to ".include" to avoid forcing
	  cweb filter, which includes cpp.key, to keep track of C and C++
	  tables.
	+ split-out cweb.key, install vile-cweb-filt
	+ add syntax filter for embedded SQL (esqlfilt.l)
	+ add syntax filter for REXX (rexxfilt.l)
	+ minor fix to c-filt.l in write_number(): recognize "..." string.
	+ correct some missing .key files in the install rule for makefile.wnt
	+ correct some forward references from 9.0j (ntconio.c, ntwinio.c).

 (tom) 991224 (j)
	+ add cygwin to list of platforms that must open text files in binary
	  mode, to see trailing carriage-returns on a line in vileinit.rc
	+ restore Kevin's change to main.c, which calls term.close() within
	  tidy_exit() after perl_exit(), to ensure that ".vilesock" is removed.
	  At the same time, call ExitProgram() directly from newprocessgroup()
	  so that xvile does not exit prematurely when invoked w/o forking
	  (analysis by Kevin Buettner).
	+ more fixes for special case numbers in c-filt.c, e.g., ".1", "..1"
	  (err), "0x.p1" (err).
	+ implement special attribute code 'N' to allow users to disable syntax
	  highlighting for a given class.
	+ indent'd random.c
	+ indent'd ntconio.c and ntwinio.c, reordering some chunks to eliminate
	  forward-references.
	+ correct an off-by-one in repaint_window() from 9.0g changes that left
	  debris after an exposure event (ntwinio.c).
	+ add rules to makefile.wnt for compiling all filters, not merely those
	  which are normally installed.
	+ correct a minor formatting error in describe-bindings for command
	  names longer than 31 characters using new function quote_and_pad().
	+ change TRACE macro usage to put a ';' on the end, since it works
	  better that way with 'indent'.
	+ fix some places where K&R/unproto combination on SunOS could not
	  compile, e.g., aggregate initialization in bind.c, termio.c.
	> Kevin Buettner:
	+ buffer.c (swbuffer_lfl):  Set MK to nullmark.  Since we're switching
	  buffers here, we want to make sure that MK doesn't refer to a line in
	  a buffer different than curbp.  This fixes the "BUG:  hit buf end in
	  getregion" message that would frequently pop up when using the perl
	  facilities.
	+ perl.xs (set_curwp0):  New function.  Use this instead of set_curwp()
	  in many of the Vile::Window methods to prevent the buffer tracking
	  list from getting updated.  [Reported by Paul Fox.]
	+ random.c (autocolor):  Save/restore dotcmdactive.  This fixes the bug
	  with "." (repeat-last-cmd) in which an autocolor() call would shut
	  off the dot recording.  As a result, "." would replay some earlier
	  command than the one you thought you were repeating.

 (kev) 991222 (i)
	+ makefile.in (capture.pl, winops.pl): New files/targets.
	+ perl.xs (perl_exit): Clear perl_interp variable so that
	  we get out early if we're called twice.  This won't
	  presently happen, but we want to be prepared if it does.
	  (stringify_coderef):  Fixed situation in which the coderef
	  was getting pushed on @Vile::CRs twice -- and also
	  incrementing the reference count twice which was preventing
	  the code ref from being freed up.
	  (perl_free_deferred): New code to work around perl bug
	  in which parts of the coderef are getting freed too
	  early causing memory corruption.
	  (perl_free_callback):  Ditto.  Also added a comment
	  regarding a (now removed) call to SvREFCNT_dec() and why it
	  shouldn't be there.  Also, don't increment the reference
	  count on a newly created integer (newSViv).  It's already
	  incremented when allocated.
	+ proto.h (perl_free_deferred): Declared.
	  (perl_free_callback): Change return type.  This is so
	  that the GROW macro may be used to increase the size
	  of the vector of Sv's to deallocate in perl_free_deferred().
	+ api.c (api_command_cleanup): Call perl_free_deferred() in order
	  to work around perl bug.  I didn't ifdef it because we may
	  someday find some other deferred allocations which need to
	  be performed.
	+ main.c (quit): Don't shut down X11's display here.
	  (tidy_exit): Shut it down here instead.
	  Fixes bug reported by Sean Ahern in which .vilesock was
	  not getting removed properly.  Thanks also to Brendan
	  O'Dea for additional insight into the problem.
	+ npopen.c (pipe_pid2): New static variable.
	  (npclose): Wait on both pids associated with a filtering
	  operation.  This cleans up the zombies (and there were a lot
	  of them) associated with automatic syntax coloring.
	  (softfork): Set pipe_pid2 for callers who are too lazy
	  to remember the pid.  [Note: I consider this to be an
	  ugly hack.  Please feel free to improve upon it.]
	+ modetbl (loading): New mode.
	+ display.c (modeline_modes): Added code for "loading" mode.
	+ capture.pl: Some improvements:
	    + Error finder now hooked up
	    + [loading] message on modeline when loading a file
	    + New name for the binding: async-capture-command instead
	      of perl-capture-command
	    + New keybinding ^A-!.  Think of the ^A as "asynchronous".
	    + Prettier header
	    + Dot reset to top of new buffer contents if appropriate
	      (If you're browsing the buffer, it won't interfere with
	      your browsing.)
	    + Lots of new comments in the code
	+ watch.c (dowatchcallback):  Do not run watch callbacks when
	  user is typing on the message line.  (This cures a nasty
	  abort that I encountered while using async-capture-command.)
	> Tom Dickey:
	+ revert Kev's change to main.c - this made xvile not run when it
	  forks on startup.
	+ compiler warnings in x11.c (reported by Michael Finken
	  <finkenm@hotmail.com>)
	+ improve attribute_from_filter() by draining a pipe that has data;
	  if the filter program incorrectly sends more data than vile expects,
	  vile would not be able to close the pipe.
	+ correct check in c-filt.c from 9.0g for nested comments; it flagged
	  adjacent comments.
	+ modify m4-filt.c to test multi-line attributes by writing Literal's
	  as a single token rather than each piece split by lines.
	+ improve attribute-from-filter and attribute-cntl_a-sequences-til to
	  allow lengths beyond the end of the current line (Kevin & I were
	  aware of this - report by Christian Lindig <lindig@ips.cs.tu-bs.de>).
	+ modify c-filt.c to highlight C9X hexadecimal floating constants
	+ add new C9X keywords to c.key: inline, restrict, _Bool, _Complex,
	  _Imaginary, _Pragma, __STDC_VERSION__, __VA_ARGS__, __func__.
	+ correction to c-filt.c's parsing of floating-point constants (missed
	  a toupper).

 (kev) 991220 (h)
	+ perl/capture.pl: New perl script which implements a perl version
	  of capture-command.  This version incrementally updates the
	  window however.
	+ perl/winops.pl: New perl script which implements various window
	  related operations.  Good for testing implementation of the
	  Vile::Window API.
	+ perl.xs: Documentation fixes.
	  (package Vile::Window):  Documentation and implementation of
	  Vile::Window API.
	  (perl_free_callback): Disable deallocation of the coderef since
	  this causes problems when called from within the subroutine
	  being deallocated.  Added a FIXME comment noting the problem.
	  (set_selection, selection_buffer): Fixed croak messages.
	  (dotq): New Vile::Buffer method.
	+ api.c (api_dotinsert): Set changed flag.  This fixes a bug
	  where perl would add characters to the buffer, but they
	  wouldn't appear until the user did something else to force
	  a hard update.
	  (api_command_cleanup): Make sure results of unmark operation
	  get propagated back to the editor.
	+ api.h (VileWin): Declare.
	+ buffer.c (swbuffer_lfl): Don't call undispbuff() unless all
	  windows associated with the buffer are gone.
	+ estruct.h (WINDOW): Added w_id as a new field to this structure.
	+ window.c, proto.h (id2win, win2id, index2win, win2index):
	  New functions.
	+ window.c (w_id_next): New static global.
	  (FAKE_WINDOW_ID): New define.
	  (splitw, winit, push_fake_win): Set/initialize w_id field in
	  WINDOW structure.
	+ ptypemap (T_VileWin): New type in typemap.
	+ x11.c (x_autocolor_timeout): Send a null message to ourselves
	  to prevent stalling in the event loop.  This fixes the bug
	  in which a keypress while the filter was running would
	  cause the keypress to be noticed at the next X event.
	  (paste_from_primary): New function.
	+ cmdtbl (paste-from-primary): New command.  (Requested by Sean
	  Ahern.)

 (kev) 991219 (g)
	+ cmdtbl, buffer.c:  Added binding / support for ^X-_ aka
	  "historical-buffer-to-current-window".  [Requested by Mike J.  Bell.]
	+ random.c (autocolor):  Save/restore pre_op_dot.  Fixes bug reported
	  by Paul Fox:  "if autocoloring kicks in between an operation and the
	  motion that completes it (e.g.  'd' and 'w'), the operation acts on
	  the wrong selected region -- i think it acts on 'dot to top of
	  buffer'."
	+ improve set-window (actually swbuffer()) by initializing a window's
	  traits, e.g., position, from the buffer's traits.
	+ buffer.c (swbuffer_lfl):  Make sure window count gets decremented for
	  the window being replaced even if buffer we're replacing it with is
	  already on-screen (fixes a core dump in set-window, reported by Clark
	  Morgan).
	+ fileio.c (ffclose): Use mlwrite() instead of mlforce().
	+ edef.h (in_autocolor): New variable.
	+ display.c (mlerase, mlwrite):  Use in_autocolor to determine whether
	  or not to position the cursor on the message line.
	+ random.c (autocolor): Set autocolor as appropriate.
	+ macros/vileinit.rc, vile.hlp:  Revise so that autocolor timeouts are
	  in milliseconds.
	+ termio.c (ttgetc): Likewise.
	+ x11.c (x_start_autocolor_timer): Ditto.
	> Clark Morgan:
	+ ifdef'd autocolor mode and logic with OPT_COLOR to accommodate VMS,
	  which does not support syntax highlighting anyway.
	+ fix vmsbuild.com for the case of building xvile.exe with VAXC, adding
	  menu.obj to vms_link.opt _before_ the CRT.  That ensures that the
	  linker looks for menu.obj in the cwd, not in sys$library.
	> Tom Dickey:
	+ improve logic of repaint_window(), so it paints long chunks rather
	  than single characters.  This makes the screen paint properly when
	  switching to an Italic font.
	+ refine logic for gui_resize_in_progress in ntwinio.c so that it
	  only affects the case where a font-sizechange is in progress.
	  This restores the behavior of 8.3d, which allows a user to specify
	  $pagewid and $pagelen in vile.rc to control the initial screensize
	  (reported by George Young <gryoung@nortelnetworks.com>).
	+ add $brightness variable to winvile, allowing users to customize the
	  overall intensity of colors, to accommodate different monitors
	  (prompted by Chris Green <cgreen@x-1.net>).
	+ modify backspacelimit mode to allow backspacing through a newline
	  when nobackspacelimit is specified (request by Todd Moody
	  <tmoody@mailhost.sju.edu>).
	+ change Kevin's use of in_autocolor which suppresses message-output to
	  make that part of ~hidden behavior.
	+ remove elif/else clauses from m4mode "do" group, since they interfere
	  too much with balancing square brackets intermixed with parentheses.
	+ implement poll()-based watchfd/autocolor support.
	+ implement BeOS-specific watchfd/autocolor support, by rearranging
	  logic used for catnap(): beos_has_input(), beos_can_output() and
	  beos_napms().
	+ make repeat-count apply to @register commands.  This repeats the
	  entire command, and is not necessarily compatible with vi: some
	  implementations do not recognize a repeat count, and other, e.g.,
	  SVr3 repeat the last command in the register contents.  elvis does
	  the former, nvi does the latter, and vim repeats the entire string.
	  It's fortunate that the simpler implementation is more useful
	  (requested by Ed Henderson).
	+ modify vilefilt.l to recognize .vilemenu syntax.
	+ modify menu.c to allow double-quote as comment-marker.
	+ remove full-line behavior from goto-char command.
	+ correct behavior of "Clear Highlighting (below)" menu entry in sample
	  vilemenu.rc which did not clear the final line of a buffer (sorry - I
	  misplaced the original report).
	+ add some pointer checks to swbuffer(), getcol() and gocol(), so
	  piping to vile works properly when trying to initialize window's
	  traits.
	+ add a note about set-window to vile.hlp
	+ improve coloring of literals in vilefilt.l by interpreting strings
	  beginning with ^A, ^X or escape.
	+ modify c-filt.c show nested-comment as error.
	+ fix c-filt.c to highlight properly a number immediately after a
	  leading "#", to accommodate non-standard usage by GCC's preprocessor.

 (kev) 991214 (f)
	+ buffer.c (chg_buff, unchg_buff): Set the "recently changed"
	  flag for syntax coloring purposes.
	+ edef.h (autocolorhook): Declare.
	+ macros/vileinit.rc: Added example code for automatic syntax
	  coloring.
	+ main.c (global_val_init): Initialize VAL_AUTOCOLOR.
	+ modetbl (AUTOCOLOR): New mode.
	  (autocolor-hook): New hook.
	+ perl/shell.pl: Revised to use IO:Pty instead of Comm.pl (which
	  seems to be no longer maintained).
	+ proto.h (autocolor, ttwatchfd, ttunwatchfd): New declarations.
	+ random.c (run_a_hook): Return status from running the command
	  instead of unconditionally returning TRUE.
	  (autocolor): New function.
	+ statevar.c (var_AUTOCOLORHOOK): New function.
	+ tcap.c (term): Use ttwatchfd and ttunwatchfd instead of the
	  nullterm versions.
	+ termio.c (USE_SELECT): New alternative to USE_FCNTL and
	  USE_FIONREAD.  Preferred over both of these methods for
	  determining if there are new characters to be read from
	  the keyboard.
	  (watchfd_read_fds, watchfd_write_fds, watchfd_maxfd): New
	  static variables.
	  (ttwatchfd, ttunwatchfd): New functions.
	  (ttgetc): Added new USE_SELECT code for reading a character.
	  This new code also watches for activity on file descriptors
	  registered with watchfd() and will invoke the automatic
	  syntax coloring function, autocolor, as appropriate.
	+ vile.hlp: Documented new autocolor mechanism.
	+ x11.c (x_start_autocolor_timer, x_autocolor_timeout,
	  x_stop_autocolor_timer): New functions.
	  (x_getc): Call x_start_autocolor_timer and x_stop_autocolor_timer
	  as appropriate.
	  (x_key_press): Call x_start_autocolor_timer to reset the timer
	  on each keystroke.
	> patches by Tom Dickey:
	+ color continued comment-lines in makemode.
	+ correct c-filt.c parsing of numbers such as 0.0, from 9.0e rewrite.
	+ correct display of termcap numbers, which were highlighted as errors
	  after allowing '#' in capability-names.

 (tom) 991212 (e)
	+ improve c-filt.c's parsing of numbers to flag spuriously-repeated
	  suffixes as errors (request by Kevin Buettner).
	+ indent'd word.c, add a special case to avoid putting two spaces after
	  "i.e." or "e.g." to accommodate some European usage.
	+ add several perl5 keywords to perl.key (listed by <abigail@delanet.com>)
	+ remove "unsetl view" logic from :f command, since it is an obscure
	  and not desirable side-effect.  Appeared in filename() and
	  commdlg_save_file() (reported by Clark Morgan).
	+ modify HighlightFilter to check if user is trying to run this with
	  winvile w/o w32pipes set.  That combination does not work, so don't
	  try it.
	+ update CF_ANSI_CC_CHECK to match that in tin, which now uses -Ae
	  option for HPUX (patch by Urs Jansen).
	+ modify config.sub to recognize ia64 machine (patch by Kevin Buettner).
	+ allow '_' and '.' in terminfo aliases.
	+ correct a file-descriptor leak in npflush for win32, which showed up
	  as undeleted temp-files.  This would happen when opening read/write
	  pipes, e.g., for syntax filtering, when now32pipe was specified.
	+ remove obsolete/unused Win31 ifdef's (reported by Clark Morgan).
	> patch by Clark Morgan:
	+ changed the VMS build document (README.VMS) to specify exclusive use
	  of vmsbuild.com rather than MMS directly.
	+ changed vmsbuild.com to accept a compiler specification on the
	  command line, which is much more convenient than editing the build
	  script by hand.  compiler defaults to VAXC on Vax hosts and DECC on
	  Alpha hosts.

 (tom) 991209 (d)
	+ implement "before" and "after" qualifiers for majormodes.
	+ add C++ majormode cppmode,
	+ change prompt for majormode in procedure parameter lists to allow
	  mixed case.
	+ add ".table" and ".default" to filter interpreter.
	+ add a syntax filter for vile's .key files, use that to fix some
	  errors in make.key, tcl.key .
	+ add a syntax filter for Lynx config file.
	+ add '_' to URL patterns, used in txt and mail filters.
	+ corrected DSTRINGS definition in awk syntax filter, which did not
	  handle quoted backslash.
	+ allow '+' in alias in termcap syntax filter.
	+ add variable $error-buffer, use this in manpage.rc to avoid losing
	  the setting when creating a manpage buffer.
	+ add error-patterns for ncurses tic and atac.
	+ implement ".merge" in filter keyword files, needed for C and HTML
	  filters.
	+ improve C syntax filter:
	  + marking misspelled preprocessor keywords as an error.
	  + marking numbers run-on to names as an error,
	  + marking unexpected escapes as an error,
	+ minor fixes of ifdef's for glob_match_leaf(), for building with
	  configure --disable-extensions.
	> patches by Clark Morgan:
	+ add the Win32 common dialog "save as" feature to both console
	  vile and winvile.
	+ update vile.hlp was updated to reflect recent
	  questions about macros.doc
	+ split-out the win32 command-specific code (e.g., winopen, winsave,
	  etc) from w32misc.c to a new file called w32cmd.c
	+ add a note about obscure "unsetl view" side-effect of the :f command
	+ add special case to expand_wild_args() for VMS to handle +/string
	  syntax.
	+ update README.VMS for building xvile
	+ fix for VAXC to include icons/vile.xbm

 (tom) 991202 (c)
	+ modified vmsbuild.com and descrip.mms (untested) to build the Motif
	  version with menus, the X toolkit version without (based on discussion
	  with Clark Morgan and Jonathan Ridler).
	+ fix ttclean() function for xvile on VMS (Clark Morgan, from problem
	  report by Jonathan Ridler <JONATHAN@rubens.its.unimelb.edu.au>).
	+ add .Xdefaults to xresmode.
	+ add backslashes as needed to digraph.rc, to work with the new single
	  quote interpretation (reported by Paul Fox).
	+ correct a place where expression evaluation result was overwritten
	  with the nested result in a complex expression from 8.3d (reported
	  by George Eccles).
	+ highlight whitespace in makefiles between backspace and newline as
	  an error.
	+ define "Error" class for syntax filters.
	+ correct make filter's handling of escaped newline: '.' does not match
	  newline.

 (tom) 991127 (b)
	+ add "case" and "do" groups to m4mode.
	+ add ".ms" and ".me" suffixes for nrmode.
	+ add ``quote'' quoting to txt filter.
	+ refine treatment of double-quote in txt filter so it can be quoted
	  by single-quote or parenthesis.
	+ allow "~" in URL patterns for txt and mail filters, omitted in 9.0a.
	+ correct some missing backslashes before vertical bar and parentheses
	  in filters.rc, made apparent by the change to use single-quoted
	  strings.
	+ restore handling of special control characters such as ^D, ^T in
	  insert mode which happened to be GOAL or MOTION commands (reported by
	  Clark Morgan).

 (tom) 991124 (a)
	+ add single-quoted strings, which eliminate the need for escaping
	  backslash (suggested by Paul Fox).
	+ modify logic in ins_any_time() to interpret control characters which
	  are bound to GOAL or MOTION commands rather than inserting them
	  without quoting.  This allows ^E and ^Y as commands within an insert
	  (request by Quang Ngo <quang@usa.net>).
	+ change several commands to use GOAL flag, which tells vile that they
	  may move to a new line, but try to keep the column constant.  Doing
	  this has the side-effect that they are usable in quoted-motion:
	  grow-window, move-next-window-down, move-next-window-up,
	  position-window (z), redraw-display, scroll-next-window-down,
	  scroll-next-window-up and shrink-window, as well as api_motion().
	+ modify quoted-motion so that commands with the GOAL flag are allowed,
	  since those do not change the buffer contents.
	+ change handling of status return from readpattern() so that an abort
	  is passed up to the caller.  In execute-named-procedure, check for
	  abort, and restore DOT to the value before evaluating addresses
	  (reported by Clark Morgan).
	+ correct bug in wrapmargin/fillcol logic which did not split a line
	  when a newline was inserted into a string containing no blanks
	  after the fillcol position.  Instead, an empty line was inserted
	  (reported by Clark Morgan).
	+ correct missing allocation of default help-string for user-defined
	  procedures, which could cause core dump if a procedure were redefined,
	  e.g., by source'ing .vilerc (reported by Paul Fox).
	+ add tags syntax filter and majormode tagsmode.
	+ add X resource syntax filter and majormode xresmode.
	+ improve URL pattern in mail and txt filters, to allow it to match
	  ftp and other URL types, as well as limited the pattern to avoid
	  picking up things like trailing '>' characters.
	+ correct some syntax filters' expressions for REAL, which were
	  expecting two digits after the decimal point, rather one.
	> patches by Clark Morgan:
	+ enable "kill-buffer <wildcard-expr>" on VMS.
	+ fix to allow accessing multiple versions of DECNET-based files.
	  That is, this now works:
		$ vile node::dir:log.txt;*       <- open all copies of log.txt
	+ eliminate stray cursor glyphs in the message buffer (most often
	  happens when a Win32 dialog is dismissed at the "same time" that a
	  winvile command writes status text).

This change log started on Friday Nov 19, 1999.
