

Setting Win32-Specific Modes
============================
The values of the "w32pipes" and "force-console" modes significantly affect
the editor's interactions with the shell.  The good news is that the editor
optimally sets these modes when the host OS is Windows NT or Windows 2000
(aka W2K).  Consequently, if NT/W2K is your only expected operating
environment, the remainder of this document is of no interest.  Otherwise,
you plan to use Win9x/WinME and should definitely continue reading.

Note:  For the remainder of this document, a generic reference to "vile"
       refers to both the console and GUI editor, unless otherwise stated.


Background
==========
Command.com, the 16-bit shell supplied with the original version of Windows
95, exhibits many, many problems when communicating with another
application via an anonymous pipe.  Consequently, w32pipes and
force-console were created to permit the user to avoid as many of those
problems as possible.

After the initial Windows 95 release, Microsoft eventually rolled out a
bugfix called OSR2.  However, OSR2 is only available from OEM's (e.g.,
Dell, Gateway, etc.) for distribution with a new PC.  It's not known if any
of command.com's anonymous pipe bugs were fixed in that release of the OS.

Thereafter, Windows 98 was released in the summer of 1998 and WinME soon
followed on its heels.  Unfortunately, it appears that command.com did not
change much with the release of either OS.


w32pipes
========
This boolean mode, if set, enables native anonymous pipe communication
between the editor and the shell for the following operations:

   :r !<cmd>             (read pipe)
   :w !<cmd>             (write pipe)
   <filter region>       (e.g., !}fmt)
   ^X-!

If not set, the above operations are instead emulated via temporary files.


force-console
=============
If w32pipes is set, then winvile (only) consults force-console to decide
whether or not to explicitly create a console prior to initiating a read
pipe or filter region operation.  In general, force-console is required
only when using a 16-bit shell (e.g., command.com) or when invoking 16-bit
programs/filters.


Trade-Offs
==========
If using console vile and command.com (i.e., using the default Win9x/WinME
shell), w32pipes must _not_ be set.  This means that pipe operations will
be effected with temporary files.  Unfortunately, write pipes simply don't
work via temporary file communication, which means that filter operations
(including syntax coloring) will behave erratically.  Note that 32-bit
replacement shells (e.g., Thompson Toolkit shell, Cygwin's bash, MKS shell,
etc.) don't suffer from anonymous pipe bugs and w32pipes may safely be set
(assuming, of course, that the editor's $shell state variable specifies the
path of the replacement shell).

If using winvile, w32pipes _must_ be set for all shells and versions of
Win98/WinME tested to date.  When w32pipes is not set, _all_ pipe operations
will fail.  Additionally, force-console mode must be set if using a 16-bit
shell or invoking 16-bit apps.  If not set, the editor will hang and most
likely lock up the OS as well.  Note that when w32pipes is set and
command.com is used as the shell, the floppy is accessed during each pipe
operation.  Additionally, setting force-console causes each read pipe and
filter region operation to briefly pop up and pop down a black, background
console.  Sigh.


Configuring Winvile and Vile via vile.rc
========================================
~if &not &sequal "Windows_NT" &env "OS"
    ; Assume host is Win9x/WinME
    ~if &sequal $progname "winvile"
        ; change next statement to "set noforce-console" when using 32-bit
        ; shell and not invoking 16-bit apps
        set force-console
        set w32pipes
    ~elseif &equal 0 &sindex &lower $shell "command.com"
        ; shell is not command.com--assume it's 32-bit and can handle
        ; native pipe operations
        set w32pipes
    ~else
        ; shell is command.com--native pipes not a good idea
        set now32pipes
    ~endif
~endif


Optimum Console Vile Settings
=============================
Entries in the table marked  ?  have not been tested.  If your host
environment matches an untested entry in the table and you have validated
various mode settings, please send your results to the "vile-bugs" mailing
list:  bugs@vile.cx or vile-bugs@foxharp.boston.ma.us .

host   shell         w32pipes  force-console  trade-offs/comments

NT/W2K any 32-bit      set        N/A         no problems, [1]
Win9x  command.com     unset      N/A         no write pipes
Win9x  any 32-bit      set        N/A         no problems, [2]
OSR2      ?             ?         N/A             ?
WinME  command.com     unset      N/A         no write pipes
WinME  any 32-bit      set        N/A         no problems, [2]
WinXP     ?             ?         N/A             ?

Note 1:  if not using cmd.exe (the default WinNT/W2K shell), see note 2.

Note 2:  explicitly specify a path to the shell in vile.rc via the $shell
         state variable (e.g., setv $shell 'c:\usr\binw\sh.exe').


Optimum Winvile Settings
========================
Entries in the table marked  ?  have not been tested.  If your host
environment matches an untested entry in the table and you have validated
various mode settings, please send your results to the "vile-bugs" mailing
list:  bugs@vile.cx or vile-bugs@foxharp.boston.ma.us .

host   shell         w32pipes  force-console  trade-offs/comments

NT/W2K any 32-bit      set        unset       no problems, [1]
Win9x  command.com     set        set         floppy grinds, transient console
Win9x  any 32-bit      set        [2]         [3]
OSR2      ?             ?          ?              ?
WinME  command.com     set        set         floppy grinds, transient console
WinME  any 32-bit      set        [2]         [3]
WinXP     ?             ?          ?              ?

Note 1:  if not using cmd.exe (the default WinNT/W2K shell), see note 3.

Note 2:  If 16-bit apps will _not_ be invoked, it's safe to unset
         force-console.  If set, a transient background console appears
         during each read or write pipe operation.

Note 3:  explicitly specify a path to the shell in vile.rc via the $shell
         state variable (e.g., setv $shell 'c:\usr\binw\sh.exe').

-- $Header: /users/source/archives/vile.vcs/doc/RCS/w32modes.doc,v 1.8 2001/08/17 18:55:37 cmorgan Exp $
